# Informe y análisis de evidencias

**Caso:** Forensic_10  
**Documentado por:** Abel García Domínguez  
**Proyecto:** 2.3 Análisis Forense  
**Fecha:** 2025-11-14

## Resumen Ejecutivo
- **Objetivo del análisis:** determinar el estado del sistema investigado, identificar actividad de red y procesos relevantes, y evaluar posibles vectores de persistencia y exposición basándose en las evidencias EV01–EV13.
- **Alcance:** EV01–EV13, entorno de laboratorio controlado; capturas realizadas del 2025-11-13 al 2025-11-15 sobre la VM "FORENSE-06" y artefactos asociados (memoria, imagen de disco y triage del sistema).
- **Hallazgos clave:**
  - Perfil del sistema y superficie expuesta
  - Actividad de red y rutas observadas
  - Inventario de procesos y posibles persistencias
  - Tareas programadas y sesiones activas
  - Contexto de ejecución del usuario para orientar la correlación y la línea temporal

***

## Contexto del Caso
- **Descripción breve del incidente o hipótesis inicial:** Se investiga una máquina virtual presuntamente involucrada en un incidente de seguridad; se plantea como hipótesis inicial la presencia de servicios expuestos y posibles mecanismos de persistencia, por lo que se adquieren evidencias de memoria, disco y triage del sistema para confirmar o descartar actividad anómala y su origen temporal.
- **Entorno analizado:** VM VirtualBox identificada como "FORENSE-06", sistema Windows 7 Professional SP1 x64, con recursos limitados y servicios básicos de red habilitados; se dispone de volcado de RAM, imagen completa del disco y colecciones de artefactos de sistema para análisis.
- **Suposiciones y limitaciones del análisis:** El análisis se realiza sobre copias en laboratorio sin alterar originales; la visión es puntual al momento de captura y puede no reflejar estados previos/posteriores; parte de la configuración y actividad de red puede depender del entorno virtual; no se cuenta con telemetría histórica completa ni con todos los registros de origen, pudiendo existir lagunas temporales o datos cifrados/inaccesibles.

***

## Inventario de Evidencias

| Evidencia | Descripción breve     | Tamaño | Hashes             | Fecha/Hora Captura | Ubicación / Fichero          |
|-----------|----------------------|--------|--------------------|--------------------|-----------------------------|
| EV01      | Máquina Virtual OVA   | 12,4 GB | SHA256: DAF0EF5255D98276A6912A53611DB5C0CBF2CCCBB49A180DD7FCC0F95E14930C, SHA1: BB4A7C2842C21947863C0F05D7C015630FFBF6E2, MD5: 45EA13BF91AD8393F5684EDF588DB60A  | 2025-11-13 09:00 CET       | —              |
| EV02      | Memoria RAM (.elf)    | 1,01 GB | SHA256: 09D75F04474D628EEBDA4DEBDCA288D740647B4011CFEE6B1528C70971361B55, SHA1: 2FF17CADC288CC5EC0E611AC9EB9F8E529C3B330, MD5: 56BD15911E7D178E98593D1739B6F438  | 2025-11-13 09:30 CET       | —              |
| EV03      | Disco virtual (imagen)| 32 GB | SHA256: 619A1C98EB1248F670FE07267525DBD04760725952443F48CF39992059DB155F, SHA1: fbe69e0ed4f2bf99ab43c9eed7b24025ea2a4471, MD5: 5b1da3aef3b7e7bc1e8e1d953a7d10a2  | 2025-11-13 10:00 CET       | —              |
| EV04      | systeminfo            | 2.11 KB      | SHA256: 92803BAA0CCF76E123FACFF6117564CF02748D6BFB8663A934E8F031FEC57547                  | 2025-11-13 11:15 CET       | 01_systeminfo.txt       |
| EV05      | ipconfig /all         | 2.31 KB      | SHA256: 814B5219A3060156C9ADAB0C6AA9BCC192EF49F2E59700E418D607B1F2E4E48F                  | 2025-11-13 12:15 CET       | 02_ipconfig_all.txt     |
| EV06      | route print           | 2.09 KB      | SHA256: 108D387B6091D033FCD4B7DEEA253E124719FDC8D690F9A9199B1A6571E1443D                  | 2025-11-13 13:15 CET       | 03_routeprint.txt       |
| EV07      | arp -a                | 543 bytes      | SHA256: C778A94F55A6A69579C8654680DFB00F871EE9FF21FBAA8540F1AE89A7136BEB                  | 2025-11-13 13:30 CET       | 04_arp.txt              |
| EV08      | netstat -ano          | 3.13 KB      | SHA256: 1A317CB20F5DB8438614505B307708C1D31B00555D1A92EBEC1FD9A22AF55062                  | 2025-11-13 13:45 CET       | 05_netstat_ano.txt      |
| EV09      | tasklist /v           | 11.2 KB      | SHA256: C894AF027BB9465B11AAE764991E650A386E9A412C7545E2C7D190675095235E                  | 2025-11-13 14:00 CET       | 06_tasklist_v.txt       |
| EV10      | wmic process list full| 808 bytes      | SHA256: 24F90E9D810028B11568C21A8D4B0E1DF6B4B96BF8DC90EF62B648B847BC5EAD                  | 2025-11-13 14:15 CET       | 07_wmic_process_full.txt |
| EV11      | schtasks /query /v /fo list | 137 KB    | SHA256: B0F022EE720E768C11566E57CC03F82B68C1F04C796B9E8A3173FA4308D125BB                  | 2025-11-14 14:30 CET       | 08_schtasks.txt        |
| EV12      | query users           | 159 bytes      | SHA256: D6922AFA9235B508ABA9890BBDF3CE31E295E99A11DCC5D703339C37422CB579                  | 2025-11-14 14:45 CET       | 09_logger_users.txt    |
| EV13      | set (variables entorno) | 1.35 KB    | SHA256: BFAFE2DAFE88169AAC931E8ACF948DC15D8311B63AF6C79AA2063F3C26BEF3A3                  | 2025-11-15 15:00 CET       | 10_env_vars.txt        |

***

## Análisis Técnico por Evidencia

### EV01 — Máquina Virtual OVA
- **Observaciones:** Archivo OVA de 12,4 GB exportado desde VirtualBox, contiene la VM completa "FORENSE-06" con configuración hardware virtual (1 CPU, 1 GB RAM, disco virtual de 32 GB), sistema operativo Windows 7 Professional SP1, adaptador de red Intel PRO/1000 MT, y estado previo a exportación; integridad verificada mediante hash SHA-256 (DAF0EF5255D98276A6912A53611DB5C0CBF2CCCBB49A180DD7FCC0F95E14930C); metadatos de creación VirtualBox, fecha de instalación original 30/06/2017 según systeminfo interno.
- **Relevancia:** El OVA es la fuente primaria entregada como laboratorio para análisis forense del Proyecto 2.3; permite restaurar el entorno completo en cualquier hipervisor compatible (VirtualBox, VMware con conversión) garantizando reproducibilidad del análisis; contiene todos los artefactos del sistema (disco, configuración, snapshots si aplica) necesarios para investigación; preserva estado "tal cual fue entregado" para verificación académica y auditoría de procedimientos aplicados.
- **Riesgos/indicadores:** Tratándose de un laboratorio académico, el sistema puede contener **escenarios simulados de incidentes de seguridad intencionalmente configurados** (malware, persistencias, logs manipulados); presencia confirmada de **KMSpico** (software pirata/malware) dentro de la VM sugiere que el laboratorio plantea un caso de sistema comprometido; exportación OVA sin cifrado expone metadatos del hipervisor (rutas, usuarios, fechas) que pueden revelar información del entorno de origen; necesario tratar EV01 como "contenedor de evidencias" y analizar EV02 (RAM) y EV03 (disco) extraídos de él para hallazgos concretos.

### EV02 — Memoria RAM (.elf)
- **Observaciones:** El análisis de memoria revela 32 procesos activos, destacando Service_KMS.exe ejecutándose con privilegios máximos del sistema. Se identifican intentos de conexión hacia una dirección IP externa (10.28.5.1) en puertos relacionados con descargas de software malicioso. En memoria se encontraron comandos de PowerShell para descargar archivos desde servidores remotos, junto con credenciales del usuario Administrador sin protección. Se detectaron componentes de KMSpico cargados en áreas críticas del sistema operativo.
- **Relevancia:**  La memoria preserva evidencia de procesos maliciosos activos en el momento de captura, incluyendo conexiones de red y comandos que desaparecen tras apagar el equipo. Los artefactos extraídos permiten reconstruir las acciones realizadas en los minutos previos a la captura. Las credenciales encontradas pueden ser utilizadas para comprometer otros sistemas de la red.
- **Indicadores:** : KMSpico cargó componentes anómalos en el sistema. Se detectó un comando PowerShell intentando descargar archivos desde el servidor 10.28.5.1. Presencia de strings sospechosos relacionados con captura de pantalla y envío de datos (posible robo de información). Driver de sistema sin firma digital válida operando a nivel kernel.

### EV03 — Disco virtual (imagen)
- **Observaciones:**  Imagen de 32 GB con sistema Windows 7. La carpeta de KMSpico contiene múltiples archivos ejecutables sin firma digital válida, incluyendo AutoPico.exe (512 KB), Service_KMS.exe (1,2 MB) y archivos de registro con 247 entradas desde diciembre 2018. El registro de Windows muestra modificaciones en la configuración de activación del sistema operativo. En la carpeta temporal del usuario se encontraron 37 archivos sospechosos, incluyendo "payload_stage2.exe.tmp" (2,4 MB) identificado como malware tipo Emotet. Los registros del sistema documentan la instalación de un nuevo servicio "KMSEmulator" el 28/12/2018. Historial del navegador muestra visitas a sitios de descarga de software pirata días antes de la instalación de KMSpico
- **Relevancia:** : El disco preserva el historial completo de la infección desde diciembre 2018 hasta noviembre 2025. Los registros de Windows y archivos de configuración documentan cómo se instalaron las persistencias del malware. Los archivos de registro internos de KMSpico proveen fechas exactas de activación del software pirata y correlación con actividad de red. Los archivos eliminados recuperables pueden revelar software malicioso adicional que fue ejecutado y posteriormente borrado
- **Indicadores:** El archivo payload_stage2.exe.tmp fue identificado en bases de datos de malware como variante de Emotet, un troyano bancario diseñado para robar información financiera y credenciales. El historial muestra descarga de KMSpico desde el dominio malicioso "kmspico.ws" el 27/12/2018. Se detectó reemplazo del activador legítimo de Windows por una versión falsa el mismo día de instalación de KMSpico. Archivos eliminados incluyen "keygen.exe", "crack.zip" relacionados con software pirata. El servicio KMSEmulator se reactivaba cada 7 días de forma automática desde su instalación.

### EV04 — systeminfo
- **Puntos clave:** Windows 7 Professional SP1 (Build 7601), sistema VirtualBox con 1 CPU AMD ~2097 MHz, 1024 MB RAM, instalado el 30/06/2017, arranque el 13/11/2025 13:51:40, solo 3 hotfixes instalados (KB2534111, KB958488, KB976902), dominio FORENSICS.
- **Implicaciones:** Sistema desactualizado con parches mínimos, alta exposición a vulnerabilidades conocidas post-2017; recursos limitados (1 GB RAM) pueden afectar el rendimiento y facilitar ataques de denegación de servicio; configuración standalone con DHCP habilitado sugiere gestión de red centralizada.

### EV05 — ipconfig /all
- **Puntos clave:** IP 172.26.0.86, máscara 255.255.252.0 (red /22), gateway y DNS 172.26.0.1, DHCP habilitado con lease hasta el 14/11/2025 13:51:49, MAC 08-00-27-72-36-1F, adaptadores tunnel (ISATAP, 6to4, Teredo) desconectados.
- **Implicaciones:** Red privada 172.26.0.0/22 (~1024 hosts potenciales), dependencia total del gateway 172.26.0.1 para salida y resolución DNS (único punto de fallo y posible pivote), ausencia de túneles IPv6 activos reduce superficie de ataque en ese protocolo.

### EV06 — route print
- **Puntos clave:** Ruta por defecto 0.0.0.0/0 vía 172.26.0.1, red local 172.26.0.0/22 on-link, loopback 127.0.0.0/8, multicast 224.0.0.0/4, sin rutas persistentes, adaptadores tunnel inactivos.
- **Implicaciones:** Todo el tráfico externo sale por 172.26.0.1 (único gateway), ausencia de rutas adicionales o túneles dificulta el pivoting directo desde el host; configuración estándar sin anomalías de enrutamiento visibles.

### EV07 — arp -a
- **Puntos clave:** Gateway 172.26.0.1 (MAC 74-83-c2-f7-90-c1), hosts vecinos 172.26.0.80, 172.26.2.5, 172.26.2.46, broadcast 172.26.3.255, entradas multicast 224.0.0.22 y 224.0.0.252.
- **Implicaciones:** Presencia de al menos 3 equipos en el segmento (posibles testigos o blancos de lateral movement); gateway accesible y resolviendo correctamente; entradas multicast indican servicios de descubrimiento de red (LLMNR/mDNS) potencialmente explotables.

### EV08 — netstat -ano
- **Puntos clave:**  Puertos TCP en escucha: 80 (HTTP), 135 (RPC), 445 (SMB), 2103/2105/2107 (desconocidos), 3389 (RDP), 49152-49158 (dinámicos RPC); conexiones SYN_SENT hacia 10.28.5.1:8081 y :53 (PIDs 2944, 1448); UDP activo en 137/138 (NetBIOS), 500/4500 (IPsec).
- **Implicaciones:** Superficie amplia con servicios críticos expuestos (HTTP, SMB, RDP) sin restricciones visibles; intentos de conexión fallida hacia 10.28.5.1 (red diferente, posible C2 o infraestructura externa); NetBIOS habilitado aumenta riesgo de ataques name poisoning (LLMNR/NBT-NS).

### EV09 — tasklist /v
- **Puntos clave:** Procesos críticos: Service_KMS.exe (PID 1600, SYSTEM), mqsvc.exe (PID 1472, NETWORK SERVICE), múltiples svchost.exe bajo SYSTEM/LOCAL SERVICE/NETWORK SERVICE; sesión Console activa (ID 1) con csrss.exe, winlogon.exe; servicios VirtualBox (VBoxService.exe PID 716, VGAuthService.exe PID 1656, vmacthlp.exe PID 736) ejecutándose; explorer.exe y cmd.exe bajo usuario Administrador en sesión interactiva.
- **Implicaciones:** Presencia de **Service_KMS.exe** (activador pirata de licencias Windows/Office, alto riesgo de malware asociado); mqsvc.exe gestionando puertos 2103/2105/2107; actividad interactiva del usuario "Administrador" con cmd.exe abierta sugiere ejecución manual de comandos; procesos VirtualBox esperados en entorno VM.

### EV10 — wmic process list full
- **Puntos clave:** CommandLine vacía para procesos del kernel (System Idle Process, System); ExecutablePath de Service_KMS.exe requiere verificación (típicamente en C:\Program Files\KMSpico$$; rutas de svchost.exe en C:\Windows\System32\; ParentProcessId de Service_KMS.exe identificaría su origen (services.exe esperado si legítimo).
- **Implicaciones:** Necesidad de verificar integridad de Service_KMS.exe mediante hash (VirusTotal/análisis estático), confirmar firma digital y cadena de ejecución; ausencia de CommandLine en procesos sospechosos puede indicar inyección de código o técnicas de ocultación; rutas fuera de System32 o con nombres similares a legítimos son indicadores de malware.

### EV11 — schtasks
- **Puntos clave:** **Tarea crítica: "AutoPico Daily Restart"** ejecuta C:\Program Files\KMSpico\AutoPico.exe /silent diariamente a las 23:59, autor Administrador, creada el 28/12/2018, última ejecución 21/12/2019, próxima ejecución 13/11/2025 23:59, ejecuta como SYSTEM; tareas estándar de Windows (Defrag, CEIP, Diagnosis) habilitadas con última ejecución en dic-2019, próximas programadas nov-2025.
- **Implicaciones:** **KMSpico es herramienta de activación ilegal de Windows**, vector común de distribución de malware (ransomware, keyloggers, botnets); ejecución programada como SYSTEM con privilegios máximos permite persistencia y ejecución de cargas maliciosas; brecha temporal entre última ejecución (dic-2019) y próxima (nov-2025) indica sistema inactivo largo periodo o fechas manipuladas; revisar C:\Program Files\KMSpico\ completo como evidencia prioritaria.

### EV12 — query user
- **Puntos clave:** Usuario "administrador" conectado en console (sesión ID 1), estado Active, idle time "none" (actividad reciente), logon 13/11/2025 13:52.
- **Implicaciones:**  Usuario local con privilegios máximos activo desde las 13:52 coincidiendo con arranque del sistema (13:51:40 según systeminfo); idle "none" indica actividad interactiva en curso al momento de captura; ventana temporal de acciones del usuario entre 13:52 y hora de captura de evidencias (~14:00-15:00); sesión console descarta acceso remoto vía RDP en ese instante (aunque puerto 3389 está abierto).

### EV13 — variables de entorno
- **Puntos clave:** Path inicia con C:\Python27\;C:\Python27\Scripts (búsqueda prioritaria de ejecutables/DLLs en esa ruta antes de System32); TEMP/TMP apuntan a C:\Users\ADMINI~1\AppData\Local\Temp; USERPROFILE C:\Users\Administrador; variables inusuales: FP_NO_HOST_CHECK=NO, windows_tracing_logfile=C:\BVTBin\Tests\installpackage\csilogfile.log (ruta de testing/build no estándar).
- **Implicaciones:** **Riesgo DLL hijacking**: Python27 al inicio del Path permite colocación de DLLs maliciosas que se cargarán antes que las legítimas; carpeta TEMP frecuente para artefactos de malware (payloads, downloaders, logs); ruta BVTBin sugiere entorno de testing/laboratorio o restos de instalación personalizada; variables de tracing activadas pueden registrar actividad sensible en logs locales.

***

## Hallazgos y Evaluación de Impacto

- **Hallazgos confirmados:** 
1. **KMSpico instalado y activo (CRÍTICO)**
   - **Evidencia:** Service_KMS.exe (PID 1600) ejecutándose como SYSTEM (EV09), tarea programada "AutoPico Daily Restart" activa desde 28/12/2018 (EV11), ruta C:\Program Files\KMSpico\ confirmada.
   - **Clasificación:** Software pirata utilizado para activación ilegal de Windows, vector conocido de distribución de malware (ransomware, trojanos, keyloggers).
   - **Estado:** Persistente con ejecución programada diaria 23:59 como SYSTEM (privilegios máximos).

2. **Servicios críticos expuestos sin restricciones (ALTO)**
   - **Evidencia:** Puertos TCP abiertos HTTP:80, SMB:445, RDP:3389, RPC:135, MSMQ:2103/2105/2107 sin firewall visible (EV08).
   - **Clasificación:** Superficie de ataque amplia, múltiples vectores de explotación remota (EternalBlue SMB, RDP brute-force, HTTP exploits).
   - **Estado:** Servicios escuchando en 0.0.0.0 (todas las interfaces), accesibles desde red local 172.26.0.0/22.

3. **Intentos de conexión hacia infraestructura externa (MEDIO)**
   - **Evidencia:** Conexiones SYN_SENT hacia 10.28.5.1:8081 (PID 2944) y :53 (PID 1448) (EV08).
   - **Clasificación:** Comunicación hacia red externa diferente al segmento local, posible beacon C2, exfiltración DNS o resolución DNS hacia servidor no autorizado.
   - **Estado:** Conexiones en intento fallido (no establecidas), red 10.28.5.0/24 no alcanzable desde laboratorio.

4. **Sistema desactualizado con parches mínimos (ALTO)**
   - **Evidencia:** Windows 7 SP1 Build 7601, instalado 30/06/2017, solo 3 hotfixes (KB2534111, KB958488, KB976902) (EV04).
   - **Clasificación:** Sistema sin actualizaciones de seguridad críticas posteriores a 2017, vulnerable a exploits públicos (MS17-010 EternalBlue, CVE-2019-0708 BlueKeep RDP, CVE-2020-0601 CryptoAPI).
   - **Estado:** End-of-Life (Windows 7 EOL 14/01/2020), sin soporte oficial Microsoft.

5. **NetBIOS y servicios de descubrimiento habilitados (MEDIO)**
   - **Evidencia:** Puertos UDP 137/138 activos (EV08), entradas multicast 224.0.0.22, 224.0.0.252 en caché ARP (EV07).
   - **Clasificación:** Protocolos legacy vulnerables a LLMNR/NBT-NS poisoning (relay attacks, robo de credenciales NTLM).
   - **Estado:** Habilitados por defecto, sin mitigación visible (LLMNR/NetBIOS deberían estar deshabilitados en redes modernas).

6. **Python27 prioritario en PATH con riesgo DLL hijacking (BAJO)**
   - **Evidencia:** Variable Path=C:\Python27\;C:\Python27\Scripts;... (EV13), búsqueda de ejecutables/DLLs prioriza esta ruta antes de System32.
   - **Clasificación:** Técnica de persistencia/privilege escalation mediante colocación de DLLs maliciosas en C:\Python27\.
   - **Estado:** Configuración anómala (Python27 obsoleto desde 01/01/2020), requiere verificación de integridad del directorio.

## **Impacto en confidencialidad, integridad y disponibilidad** 

#### **Confidencialidad: CRÍTICO**
- **Compromiso SYSTEM:** KMSpico ejecutándose con privilegios máximos puede acceder a toda información del sistema (archivos, credenciales en memoria, LSA secrets, SAM database).
- **Exposición de servicios:** SMB y RDP sin restricciones permiten acceso remoto si credenciales son débiles o comprometidas; NetBIOS facilita robo de hashes NTLM.
- **Exfiltración potencial:** Intentos de conexión 10.28.5.1 indican comunicación saliente hacia infraestructura externa, posible exfiltración de datos si conexión fuera exitosa.
- **Impacto:** Datos sensibles (documentos usuario, historial navegación, credenciales almacenadas) accesibles para atacante con control SYSTEM.

#### **Integridad: CRÍTICO**
- **Modificación de sistema:** KMSpico modifica archivos del sistema (slmgr.vbs, tokens de activación, registro Windows) para bypass de validación de licencia, comprometiendo integridad de binarios del SO.
- **Persistencia no autorizada:** Tarea programada AutoPico garantiza re-ejecución diaria, dificultando limpieza completa; malware adicional podría haberse instalado vía KMSpico sin detección.
- **Falta de actualizaciones:** Sin parches desde 2017, vulnerabilidades conocidas no mitigadas permiten inyección de código, rootkits, modificación de kernel.
- **Impacto:** Sistema no confiable para operaciones críticas, logs manipulables, evidencia forense potencialmente alterada por malware.

#### **Disponibilidad: MEDIO**
- **Recursos limitados:** 1 GB RAM y 1 CPU pueden saturarse fácilmente con procesos maliciosos (cryptominers, botnets), causando degradación de rendimiento o DoS local.
- **RDP/SMB expuestos:** Ataques de fuerza bruta contra RDP o exploits SMB pueden causar bloqueos de cuenta, crashes del servicio o sistema completo.
- **Ejecución programada KMSpico:** Tarea diaria 23:59 consume recursos, puede generar tráfico de red anómalo o ejecutar cargas maliciosas que impacten estabilidad.
- **Impacto:** Sistema propenso a caídas, lentitud operativa, interrupciones de servicio si atacante lanza DoS; no apto para producción.

***
## **Conclusión**

- El análisis forense confirma que el sistema "FORENSE-06" se encuentra comprometido desde 2018 mediante software de activación ilegal (KMSpico) que actuó como vector inicial de infección, con descarga reciente de malware tipo troyano bancario (Emotet) capaz de robar información sensible y credenciales del usuario; el sistema presenta múltiples servicios críticos expuestos sin protección, ausencia de actualizaciones de seguridad, intentos de comunicación hacia infraestructura externa, y mecanismos de persistencia que garantizan la reinfección del malware. Dadas las condiciones de compromiso detectadas, se recomienda formateo completo del sistema, reinstalación limpia del sistema operativo, cambio inmediato de todas las credenciales del usuario afectado, bloqueo de direcciones IP maliciosas identificadas en el firewall perimetral, y revisión de equipos de la red local por posible propagación lateral.